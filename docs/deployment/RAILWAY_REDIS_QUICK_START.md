# Railway Redis Setup - 2 Minute Guide

## Your Current Setup
- **Project**: soothing-energy
- **Service**: youtube-api-server-v1
- **Status**: ‚úÖ Code is ready for caching!

## Step-by-Step Setup

### 1Ô∏è‚É£ Add Redis (30 seconds)

**In Railway Dashboard:**
1. Open: https://railway.app/project/soothing-energy
2. Click **"+ New"**
3. Select **"Database"**
4. Click **"Add Redis"**
5. ‚úÖ Wait for "Active" status

### 2Ô∏è‚É£ Connect API to Redis (1 minute)

**Add this variable to your `youtube-api-server-v1` service:**

1. Click on **"youtube-api-server-v1"** service card
2. Click **"Variables"** tab
3. Click **"+ New Variable"**
4. Enter:

```
Variable Name:  REDIS_URL
Variable Value: ${{Redis.REDIS_URL}}
```

5. ‚úÖ Service will auto-redeploy (wait ~2 minutes)

## What Railway Does Automatically

When you add Redis, Railway creates these variables in the Redis service:

```bash
REDIS_PASSWORD="<auto-generated>"
REDIS_URL="redis://${{REDISUSER}}:${{REDIS_PASSWORD}}@${{REDISHOST}}:${{REDISPORT}}"
REDISHOST="${{RAILWAY_PRIVATE_DOMAIN}}"
REDISPORT="6379"
REDISUSER="default"
```

When you set `REDIS_URL=${{Redis.REDIS_URL}}` in your API service, Railway automatically:
- ‚úÖ Resolves the reference to the actual Redis connection URL
- ‚úÖ Injects the full connection string at runtime
- ‚úÖ Handles authentication and networking

## Alternative Variable Formats

If `${{Redis.REDIS_URL}}` doesn't work, try these alternatives:

### Option 1: Build URL from components
```
REDIS_URL=redis://${{Redis.REDISUSER}}:${{Redis.REDIS_PASSWORD}}@${{Redis.REDISHOST}}:${{Redis.REDISPORT}}
```

### Option 2: Use private domain
```
REDIS_URL=redis://default:${{Redis.REDIS_PASSWORD}}@${{Redis.RAILWAY_PRIVATE_DOMAIN}}:6379
```

### Option 3: Different service name
If your Redis service is named differently (check dashboard):
```
REDIS_URL=${{redis-production.REDIS_URL}}
```

## 3Ô∏è‚É£ Verify It Works (30 seconds)

### Check Health Endpoint
```bash
curl https://your-app.up.railway.app/health
```

**Look for:**
```json
{
  "cache_status": "redis_enabled",    ‚Üê Should say "enabled" ‚úÖ
  "cache_ttl_seconds": 3600
}
```

### Check Cache Stats
```bash
curl https://your-app.up.railway.app/cache/stats
```

**Look for:**
```json
{
  "enabled": true,                    ‚Üê Should be true ‚úÖ
  "status": "connected"               ‚Üê Should be "connected" ‚úÖ
}
```

## 4Ô∏è‚É£ Test Performance (30 seconds)

```bash
# First request - SLOW (1-3 seconds, cache MISS)
time curl -X POST https://your-app.up.railway.app/video-data \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"}'

# Second request - FAST! (50-100ms, cache HIT) ‚ö°
time curl -X POST https://your-app.up.railway.app/video-data \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"}'
```

**Expected:** Second request is **10-30x faster!** üöÄ

## Check Deployment Logs

```bash
railway logs
```

**Look for these success messages:**
```
[timestamp] Redis cache connected successfully ‚úÖ
[timestamp] Cache Status: Redis enabled ‚úÖ
[timestamp] Cache TTL: 3600 seconds ‚úÖ
```

**During requests, you'll see:**
```
[timestamp] Cache MISS: youtube_api:video_data:abc123   (fetching from YouTube)
[timestamp] Cache SET: youtube_api:video_data:abc123    (saving to cache)
[timestamp] Cache HIT: youtube_api:video_data:abc123    (serving from cache ‚ö°)
```

## Troubleshooting

### Problem: Health shows `"cache_status": "redis_disabled"`

**Check:**
1. ‚úÖ Redis service is "Active" in Railway dashboard
2. ‚úÖ `REDIS_URL` variable is set in youtube-api-server-v1 service
3. ‚úÖ Variable value is exactly: `${{Redis.REDIS_URL}}`
4. ‚úÖ Both services are in the same Railway project
5. ‚úÖ Deployment completed successfully (no errors)

**Fix:**
- Check deployment logs for Redis connection errors
- Verify Redis service name matches (case-sensitive)
- Try alternative variable format (see above)
- Redeploy the service

### Problem: Logs show "Redis connection failed"

**Check:**
1. ‚úÖ Redis service is running (not crashed)
2. ‚úÖ Both services in same environment (production/production)
3. ‚úÖ Network is configured (Railway handles this automatically)

**Fix:**
- Restart Redis service
- Restart API service
- Check Redis service logs for errors

### Problem: Still slow, no cache hits

**Check:**
1. ‚úÖ Making identical requests (same URL)
2. ‚úÖ Cache TTL hasn't expired (default: 1 hour)
3. ‚úÖ Check `/cache/stats` - `keyspace_hits` should increase

**Fix:**
- Clear cache and try again: `curl -X POST https://your-app.up.railway.app/cache/clear`
- Check logs for cache HIT/MISS patterns

## Quick Reference

| What | Where | Value |
|------|-------|-------|
| **Redis Service** | Railway Dashboard ‚Üí + New ‚Üí Database | Add Redis |
| **Variable Name** | youtube-api-server-v1 ‚Üí Variables | `REDIS_URL` |
| **Variable Value** | Same place | `${{Redis.REDIS_URL}}` |
| **Cache TTL (optional)** | Same place | `CACHE_TTL_SECONDS=3600` |

## Expected Results

### Before Redis
- Every request: 1-3 seconds
- 100 requests to same video: ~100-300 seconds total

### After Redis
- First request: 1-3 seconds (cache MISS)
- Next 99 requests: ~50-100ms each (cache HIT)
- 100 requests to same video: ~8-13 seconds total
- **~15-20x faster overall!** üéâ

## Resources

- **Detailed Guide**: [ENABLE_REDIS_ON_RAILWAY.md](ENABLE_REDIS_ON_RAILWAY.md)
- **Redis Setup**: [REDIS_SETUP.md](REDIS_SETUP.md)
- **Implementation Details**: [CACHING_IMPROVEMENTS.md](CACHING_IMPROVEMENTS.md)
- **Railway Docs**: https://docs.railway.com/guides/variables#reference-variables

---

**Total Time:** ~2-3 minutes
**Difficulty:** Easy
**Cost:** ~$2-5/month (Railway Redis)
**Performance Gain:** 10-30x faster üöÄ

Got questions? Check the detailed guides linked above or Railway's documentation!
